language: python
python:
  - 2.7

services:
  - docker

install:
  - git clone https://github.com/appveyor/secure-file

script:
  - docker run -t -v $PWD/secure-file:/src frolvlad/alpine-mono mcs -out:/src/secure-file.exe /src/AppVeyor.Tools.SecureFile/Program.cs /src/AppVeyor.Tools.SecureFile/Properties/AssemblyInfo.cs
  - docker run -t -v $PWD/secure-file:/src -v $PWD/apps:/mnt frolvlad/alpine-mono mono /src/secure-file.exe -decrypt /mnt/roles/infrastructure/files/ansible_id.enc -secret $EncryptCode
  - docker run -t -v $PWD/secure-file:/src -v $PWD/apps:/mnt frolvlad/alpine-mono mono /src/secure-file.exe -decrypt /mnt/roles/infrastructure/files/ansible_id.pub.enc -secret $EncryptCode
  - sed -i -e "s/\$TRYSTACK_USER1/$TRYSTACK_USER1/g" apps/keystone_trystack1
  - sed -i -e "s/\$TRYSTACK_PWD1/$TRYSTACK_PWD1/g" apps/keystone_trystack1
  - sed -i -e "s/\$TRYSTACK_USER2/$TRYSTACK_USER2/g" apps/keystone_trystack2
  - sed -i -e "s/\$TRYSTACK_PWD2/$TRYSTACK_PWD2/g" apps/keystone_trystack2
  - sed -i -e "s/\$TRYSTACK_USER1/$TRYSTACK_USER1/g" apps/clouds.yml
  - sed -i -e "s/\$TRYSTACK_USER2/$TRYSTACK_USER2/g" apps/clouds.yml
  - sed -i -e "s/\$TRYSTACK_PWD1/$TRYSTACK_PWD1/g" apps/clouds.yml
  - sed -i -e "s/\$TRYSTACK_PWD2/$TRYSTACK_PWD2/g" apps/clouds.yml
  - travis_wait 120 sleep infinity &
  - docker run -t -e BEIJING_DOMAIN -e VNC_PORT -e VNC_PWD -e SYNC_GUIUSER -e SYNC_GUIPWD -v $PWD/apps:/mnt wangkexiong/openstackcli /bin/sh -c "cd /mnt && chmod +x advanced.sh && ./advanced.sh"

env:
  global:
  - secure: P3CLMrb6kyxK8FRmvk/wLewYR0ctpdqFGfcimOfsL+QsqoJ7OMOONg3bGSxR/u/C17kJc6iRDdfsRaj3OtroWTHsInjlVQkcqpnbOpBcykwSJbMgE5TzwqxSVL0OvhsuvvQCPGuq6q8Nyo64UEoM+CptJvhqqGPvD+A7nGVzLp7YDJpbOetYBCnKrFssoqDoToP8WcpDiArstCMwb2JzbWEbr/LK2bP7ZiEkAF4trCyamPz+E3JxXpikm7C5yxdPVRkJ6CPvTJaH983VEy10EoNcxBp+tGA+N53jCbNqmH2jvbJy3t8k1xGIJsBmdkvFJi6U8CJcKrSml8pCu7AknuU7TLcGyi26fxnrsP8NL2gUh2lTfT39qQN3pplMuPNfr4QBinisQj6XXuIFZDtWcaBYM8SczRYSQpuHHVyJTBaA48pLDnJkgcE9mTCOUgRKSEFsgMjFKZSdd6DA0+hWn0V1g8dc0gQbVEfgRvbbrCCBDpY8UFvM4GVmtqkBYtEUQe3FMfHnpqoDSdEAtoYTgDC0dtSWJMS1GFsMnjLEmFZqPIzLtntIWTTu71nr9ayKIu03YmsA5pNGWr3kfWLYhordGWTZix8cgSWgV+TOpl6kmSEhpV2ENI8gVe000y8rOPSLzExSn1D6X8aP3n5IyJQSeyMcl1yGNxXfif8g7Vw=
  - secure: A3exS83v+t7opb6XdNiaZQ7YVq/GgRE/sby2ZDyUZWEM5/Qb88B6ieN3T5XnmLvjxVlDUPr1WkU1dfkEO6fbG+RVP8mt5fqsMkZ6aeF3zvEWdsIttgXUTSsWihQw3SqDoi/PDwSZJfU68gdeuCGYFbOSGFIthnpGItjnE52gyYJui2q+ObkH5Ly4UaayjMs8Lx9O3cISoOxgO/ZmdnHykCr9u26J5tzR2JCpNUNHx0oTUl2GFYkC4MAXoJSk3IWAxMMM7frFegl00GI5yaqYXCYqzKMoO7cOUfufAQtjJ6MUqq+8Kgvsw4mRRYcFHaAre2GLveS0ra1fLC5vBBKUnoTYIWIQRkppEdaVDK1jBHwU1Q85ELedP8wceCdd8ddu5BdiOlumJC+Ajf6CG9n4FsBMwHU7vpGFhfYAg3fiMv4AeFS+SQCgjANLie4rZwonUIBWvP0KYfqrR2XsCuQrjP/GdNrZgQLv7NPapHkhqMid7X+cKKBEQZoBqTfHj9mVKxLt3fMh0sXMH6ffL/EnE+nMZpL+dtsDPHMfhMr9QJQeeiwD5sSCTwrICJKZXuFtUgtL+bs6SC0Xx0A2trFM0PY8bA0ib31cM5PXHP1FhRCpdpRBOSREEmv6xDJNZhAfN3hyMWNlrRSa6z65fAgDPns2Z+SJD14FGLqcFj2Jnbw=
  - secure: w+MCH3dlclys1OTlcNCfizjPgaeDKQIHkVPM6KRe9BJRsvAO90Y48IIGguxrwJshtFkYL4czTfvKqupvjFbWFmIqs0PS03cqVOtGvcUnn2QhcYSZ5nrHhfsuetUg4YYwAFWWghjCW0vTJP+icPQAWvU4BcXFiViu3Rp8JysbnQng21gbUteb/1yqqVU7B8dF9RHF7rFcHWNihJ37taNP31sNri90atCGjTZkH/zcMj3vC/BQ0+gbPKKeptMkiSJIq2aOorxJ22wRwwroyPIQmaJPvIywNObHTyseNLbLHUtf9jK3Nl/Los/vD4n0yNbRK4L5SIiVvQeEQnyE+V07gUnghN+M6/dEAUZFr4dEPP6BB9Yz/osUkGx/76Qj0Y4kU0s6oKiPAdvk8Z0nBSRRBG2rhSDVdfN2ZgvJWqtniASQcJVMGefgZh18oynDEBJtrl0vrxKg4m77Lnri5HqsAB8takK7892zZB5e2t4XgrMJEecrW23Vd6ANMoB20zEaqpOl+3hwmv/8K+2N2rlQqkYRBYw79bNY0vdj77CAM4zIzLRj3jefNZNoeGZn9Aq6wLVjHMrw8W28j88NkI2JNJHEqeknv3BV8YrSaQUoXpHERzKyQlkZvTePBmlLAUlo31YmPW9UWeCbkWwWvBsSEgfwfhpIf876itPAqWHUCWU=
  - secure: kf/ATkc2K12SfKWJ0OxJu/R5fEzPnWJIJpUwoWsJiZWL/S/LY/uWyg1UDQ8/U+CdVZ9o9mNfCBc52yx4C4B1QFCZ9ayMbAlbsB66M10BqUNt6RY7luTa9v43QR/31tkjMCd0q6nszcWbSritYz8VW+apVs8aQnWLshpY3gKXteun3Aeu/IfVI+nq6XIkCxS54uX0/QGWNOulzYwpXxqMeYY3xjv+vkAj3oncTRa9mmIssVfidVMgeWy/l9JGVaoiQBX0f3oxxWClRzPMJlkFDmNnGDcSr0rcokj/3vZxUzkalPXzU+Y9KB/BLHPkBFqrgxV5CM94ncQ/HuG3f107QeqG2nAvVIHeeu1LsXnVuth+hSncnuDWBdPEIT5dYt+Ov/wZC0L/BGMURB7HcgnsyTNC+eBCesceKCoTCzfr/k9xqSI52J7YYecuM1sr9maS9zyeBjnTJ1VC0j0md7/3js+slrRbipIoyu15aWwnOmZGGQsfSz/sxyd0F5Kn09L48hoEGqn0Rv8oBQw6Wv2dW4hOEYS7JeI78XaLIy7T3euMZqp++bu0zKNpyzx5QLHrvHiWFE3GswYD20dytvBtYK9HRfMuL2KrvSUMnVrZgG+7wAaaJkToe3QSjayBKxfanRbxciC16C0OWzkOgNUA237XII7wpF5NaGgJrOg10wA=
  - secure: OzJcaT5WlEbJresL6WI1VUc9kYHoGCo7UErSDtwivUYKQz9BdaSmmNI0YS7ghBTEAdJ86+2GLX8lYylZZVCnWOYqNc2u2ksPELWFDkU5ROGq71AU57vHkdTnZA42sL7XDxbZTh+jL6/9tgRveUXFQGHe5OSTEm+eOW8+lE48XxHxLpMwIqGw6K7ySTAf+azeJG6kxtonuyhPsZq5YpkO9tavAhZgrhuJZxiPgwlc1pY2YXr7RIK0bE60A3Sa5RY146FRA5AHTxKikTV46KQxeJ0tbW8yCNbhECe+I8Yw4B3UJHI3pJPm+Za3ZziGlStjYfEdcUVhNh3pd1okdcLbzOyn9QdcnEt7MQj5TmATarukRbYVdV/CGOB3MH81b3IQ6g3BH+hOSJBYUJ6Ddjcaw4dnIjkP4Ko7AipEjX6MnVLNMS2D1YKXcFTcgh2UpPzw0i4uivX81vmj40dWtAv/dsZG4yiglz/Rgd3hEFHZJ5tuVzHe7w9Med8tfDjGF4TSBmhTy7TI+jkAxR7yK3oXmF6/GcjzVDP1Af7kLcDOBbvhrafqesWq354floBWt2B8KkGEljXUXoUlA00+MOqSu6h0KHXoXLT4C4sq/6VJYEx+q708qXsrj8SUIfuqOeKJvhgT2wwEir4lrSOnB2rh18Jh3kzRPu/wsdUPKVoBAag=
  - secure: R6sT971RzvN3OXrdZ6IAwO+JsjWNkANK1bssecL8p1GDbHZVsjYMhM67D+L6SKQL07YMSToLSZJmtCHyR2NPnz9Ig6IOsfpQcgrrGajrLxgClHXUZUfJGf3m7eb0ey3OpRPkH0JJOAVhBjYYKKhEpWhu2ZOEFBoSwyCXx+UXI7C5EPrjFMCvegdmEIA8YGyvCk96UlsjgLT++uFvE8hbAjTnRDxenAs9g66wOTBzRs7+VHWrXqBAHLfw9W1GMbiZVdZjbaiZ5yFTXuTti7kdXQV15b9w2x6wMktqLmuaxt5elygJwbEEJ42YJycbBWmtyrLChrQT78tO4+Qtu3nsGnZSJgyHmlsdeCP3xmkXJ+e3dORdgEY/nBD4Hmb2lw6QafAyMePpiZQPNzFC1vGiFO6K0iwBpH3OR+WKDB7kRUQjxyDcE4kO4fcq6uFGNjVPDl+fth8wKSr5fbviYoAJd67R4yDKHFV86OBUhl8em/FE6ojJvDveNI6k469oyMgQRrIdcm9e9lkYzcrc2H7cKZsgvYwGxk7V2eOOxGEfgVNZExBO4rscM26SzimKenOogKhj/Lnzsg4ugJ4sI3s73Gnhd+hqX+ih8ue8EEuLn6nSLpYsMiGNY5OiSSfLCYO/v032QoeMyun3FRqve2DL6IlBfCOfZEzycq+YHpbGi58=
  - secure: mIRLM3iKy0bNde9agiBLUDfJvSNujgKi9yq3yuXKRQDjRu7umqn6mtZttOURzajyvB0stgUUZCaOVkwF72/U0EiXpsOaqKswL7ug8NvSTxFM0cCaM0l3Df8QqmGn+XeI64JyxibwnPQ3qeIZD+3SvDCWxHp0XzBl4LNipk0bxuHXdfKfxXx5qkt+nvio4z6p8TqtVQZJJOefjabJaA0KajBYJYuqvXmGXhgxOCpRkj4cblajptS9iblhPJTOX0baRrnv0CH/R0YvFNvG9jh+43fdnTR3e+kjiE+AYuI0Ak7eClImNFY1hshuzP5O0ZyB4+9XTaVEfU+BgLeW906zv5SvQ1SPeBJRb2eJ8zsNKuAETZfkUdSszil0hag1t9AmzgICm3VfUNZ7DRnTHyN3R0OthNff4Z8s6cTeB9LhiHPZUhONv3o1eSubNOhVLziVHtrQxkj1DsjvQ6VUZQdBzt36lJA/hMKmly1OqpmC7OsraxiPvWh+JCoburbKy2Fc4XLCZUDjdWEBlkerodTw0z6ZqMd/VYLNJBGKzojpsisrGLL0DnHBgjenabI2NIEf58DGTZk7jKybTHqZ50J0vWoykQvYbhmnEHi//zBXx944fdCyYTFJfOy7dMOi5c+dqdTJpqMj6fSi8bG4noVS6e0tbsq1bSr5Ty2CUWnT7Jk=
  - secure: P+peVPazmAzLBEKvRnh8Gcz2w1X1fRPGqMVxpU1tcrBpDtiunoLh3+8+CZnXQF25uM2YDIg8YH71c3s4q4rqo306oDqMWjKPFOWr4m2KM2sf1zsiPOwmhz47XrLDCaGza9rFCbHijUWHnoXEFD3JYIpHpQ88gADUiwYM+LPEWzaqexPoJ09AhaVxZ1bU/W9SwH6slu3c7r+kDv9YkgNnTE4+uVLU7Wj+Wte+4WsHM0RZZnkPBv5Aa8ujDX0IQp2nYBjStqtHN2Pb3tgyYyYyRL41obKa7vWAdEZOIFGYmIjNXMjuJYd0cPxzse1j8CiXwjvnMEW/bG4cB+XzdSxxdBHEOsB5Sqft8ALoToR7x4hzyeMiZXUsLQZ3INXnNKKjhMbRXgrHSdXzJujZOibWmiH5e2UqbjtGkcd8jVn2z/+SE0KGqVGD1gxHdoGPR1X8sfw/X8lNnP8qwCmP70iCW1gHLogEgzSpF8ngUqs7WJPi/r7yX1KJiFxUfOSBMQ7PRKm329Z7if2BPh1Z8yAEXN0buHAzDFUVlXJuEyizku5lIlbj6KXANGawI8jPZQacfIKWl9Dm0R3k/EVCNReojk7WEighWcP4UFv4lUNb1p37pN7VyaZtbF7/V8uv9iumlGVPWJ3kigFuE0jVZK89Lf1QhCcAi2hr6TwjjfbpRRw=
  - secure: ISSHohnKkIR8c/nVH0NwLOzyaSigge7Q6/vDlVsFRwZ0ZCh7Trl1xkLcKdtBwiQW9XfaOakWftdY8BlsP67VS4o7zIfWw4TV2KFtQqs7pkApeauQoFeKLlUs50Gn5L0rgzjhvTX6+/GZsOewuXgrdsXZscHbmobeMsCLs9NkqVzCA9yWqH/MzYu3yDV6gIga+IH7JP9KqzqO7hhG0R8g8gELqn7W+PCR0iNlPie0iqvJ7BGALjSa5wPMtXI+6Bt3bY0RrMWGCh/lGe6CprWiy2HHtkjPL79UQFJvePMxNc3hWU1yQL0j+FNVBOfxqukcB+6mBmgdvdsPJP1LeTK8CBy6Gc+aOBE5KQJgI/d5hHCAbKCASrqOrQNj/qLxNImcJ/fKAsDo/lO27wOUnM9Z2pcbEVnL5I93QT78rXbZG/fuca/MgGsaxK2qZF40bZtHjsYEYgPb+FzfMDqX7deAi6OZEIglLj0iYfXnMBjpcYeWHsWbeFPutBVKiYDeuM/uGBUG5sWF2jFl9wyPziu37NjXqfKuvW0ldzw6sOt+GhpLr/A0ufBScq4wLQYesdVVFGZeAl+ZHrpfiaS1t1bV3s4fgZPL5tUt+fh2m335VEj852b1MNag6EOR6W+Vere4I9yB2uecEn2s020r4K53N08crnrIBw/qZYxmJX9TWNs=
  - secure: QTw8NKn0ZMNCRkaUiJJ/9yIPy2sX4rrTw814aHVSI4qmrVo0ddAp4QkuxWAyxnE3AK3E3H7SGpJdE31d6jU3zstn+SieI/XnTGZCUoV0YPHMifqkIU0Bua1a3wqxNnMJdJJGOeFinIOpjh6Wd915mHZ/2AqPANgck2P6JuaY7WLsDYt/T0RPSHXHGVHKFs2aJGJs7eXHhd2CY6A+GvKOJ2Evg9bCctQ+sIgjbpYU4D8/RPdieBHHqCk6tJX6/Bw7pQYAmI19Z0xsBacJ1WgC3yPGqz2F3XlY8Vu/uKtn9ofABkh+nkmAIi9afzSjXngUAZD8G3AoM6voTtkrC8hnmoNZoH7r35uPW2xg0jW814tAxzuZ79sMKyMc6/Js1i+2l8zx+uXIJW+V+nz41wFKGOAH2Zs9jdJ0ncQOejhxv42imUCT65m8GrUEr+vwioNuZ56DxUzBXoBjBTvtihaBkIO8JdKHoMUB7/hBLmAx6Eo/9udTOrVSlNNhsf9DDHF+xQyL8Bgt2fo9Wv8Du0trvt0hqG/bo43TeqhSVwgAa2z2BuPYKciIk+D8DjJyer8KSoJ0Zff3vFKh04xhCN5vQoRJG/eU2dwvKyA5ZpNrcZuA/riDOvA7V+Gi2PYDnYzxY41wvHjv7xEZSwy2zXpcNo72WG7B9J2cI/82k/8CuY0=
